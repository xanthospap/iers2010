# --------------------------------------------------------------
# MAKEFILE FOR LIBIER10++ LIBRARY
# PART 2 / MAKEFILE FOR SRC
# @configure_input@
# --------------------------------------------------------------

# include top-level configuration Makefile
include $(top_srcdir)/Makefile.conf

# Package-related substitution variables
package        = @PACKAGE_NAME@
version        = @PACKAGE_VERSION@
tarname        = @PACKAGE_TARNAME@
distdir        = $(tarname)-$(version)

# Prefix-related substitution variables
prefix         = @prefix@
exec_prefix    = @exec_prefix@
bindir         = @bindir@
includedir     = @includedir@
libdir         = @libdir@

CXXFLAGS  = -c $(C11) -Wall $(OPT) $(USE_EXTERNAL_CONSTS) $(QUICK_EXIT)
LDFLAGS   = $(C11) -Wall $(OPT) $(USE_EXTERNAL_CONSTS) $(QUICK_EXIT)
LIB       = ../$(package)v$(version).a
SRC       = fundarg.cpp  pmsdnut2.cpp  utlibr.cpp fcnnut.cpp arg2.cpp \
            dehanttideinel.cpp rg_zont2.cpp cnmtx.cpp ortho_eop.cpp apg.cpp \
            gpt.cpp gpt2.cpp st1idiu.cpp st1isem.cpp st1l1.cpp step2diu.cpp \
            step2lon.cpp cal2jd.cpp dat.cpp etutc.cpp eval.cpp recurs.cpp \
            shells.cpp utils.cpp spline.cpp tdfrph.cpp admint.cpp
OBJ_     := $(SRC:%.cpp=%.o)
OBJ       = $(addprefix ../obj/, $(OBJ_))
HEAD      = iers2010.hpp

all: mkdirs $(LIB)

install:
	install -d $(DESTDIR)$(libdir)
	install -d $(DESTDIR)$(includedir)
	install -m 0744 $(LIB) $(DESTDIR)$(libdir)
	install -m 0744 $(HEAD) $(DESTDIR)$(includedir)

mkdirs:
	-mkdir ../obj 2>/dev/null

clean:
	-rm $(OBJ) 
	-rm $(LIB)
	-rm -rf ../obj
	-rm Makefile

Makefile: Makefile.in ../config.status
	cd .. && ./config.status $@

../config.status: ../configure
	cd .. && ./config.status --recheck

$(LIB): $(OBJ)
	ar rc $(LIB) $(OBJ)

../obj/fundarg.o: fundarg.cpp $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) fundarg.cpp
../obj/pmsdnut2.o: pmsdnut2.cpp ../obj/fundarg.o $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) pmsdnut2.cpp
../obj/utlibr.o: utlibr.cpp ../obj/fundarg.o $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) utlibr.cpp
../obj/fcnnut.o: fcnnut.cpp $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) fcnnut.cpp
../obj/arg2.o: arg2.cpp $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) arg2.cpp
../obj/rg_zont2.o: rg_zont2.cpp $(HEAD) ../obj/fundarg.o
	$(CXX) $(CXXFLAGS) -o $(@) rg_zont2.cpp
../obj/dehanttideinel.o: dehanttideinel.cpp $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) dehanttideinel.cpp
../obj/cnmtx.o: cnmtx.cpp $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) cnmtx.cpp
../obj/ortho_eop.o: ortho_eop.cpp cnmtx.cpp $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) ortho_eop.cpp
../obj/gpt.o: gpt.cpp $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) gpt.cpp
../obj/gpt2.o: gpt2.cpp $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) gpt2.cpp
../obj/apg.o: apg.cpp $(HEAD)
	$(CXX) $(CXXFLAGS) -o $(@) apg.cpp
../obj/st1idiu.o: dehanttideinel/st1idiu.cpp dehanttideinel/dehanttideinel.hpp
	$(CXX) $(CXXFLAGS) -o $(@) dehanttideinel/st1idiu.cpp
../obj/st1isem.o: dehanttideinel/st1isem.cpp dehanttideinel/dehanttideinel.hpp
	$(CXX) $(CXXFLAGS) -o $(@) dehanttideinel/st1isem.cpp
../obj/st1l1.o: dehanttideinel/st1l1.cpp dehanttideinel/dehanttideinel.hpp
	$(CXX) $(CXXFLAGS) -o $(@) dehanttideinel/st1l1.cpp
../obj/step2diu.o: dehanttideinel/step2diu.cpp dehanttideinel/dehanttideinel.hpp
	$(CXX) $(CXXFLAGS) -o $(@) dehanttideinel/step2diu.cpp
../obj/step2lon.o: dehanttideinel/step2lon.cpp dehanttideinel/dehanttideinel.hpp
	$(CXX) $(CXXFLAGS) -o $(@) dehanttideinel/step2lon.cpp
../obj/cal2jd.o: dehanttideinel/cal2jd.cpp dehanttideinel/dehanttideinel.hpp
	$(CXX) $(CXXFLAGS) -o $(@) dehanttideinel/cal2jd.cpp
../obj/dat.o: dehanttideinel/dat.cpp dehanttideinel/dehanttideinel.hpp
	$(CXX) $(CXXFLAGS) -o $(@) dehanttideinel/dat.cpp
../obj/admint.o: hardisp/admint.cpp hardisp/hardisp.hpp hardisp/tdfrph.cpp hardisp/spline.cpp hardisp/eval.cpp hardisp/shells.cpp 
	$(CXX) $(CXXFLAGS) -o $(@) hardisp/admint.cpp
../obj/etutc.o: hardisp/etutc.cpp hardisp/hardisp.hpp
	$(CXX) $(CXXFLAGS) -o $(@) hardisp/etutc.cpp
../obj/eval.o: hardisp/eval.cpp hardisp/hardisp.hpp
	$(CXX) $(CXXFLAGS) -o $(@) hardisp/eval.cpp
../obj/recurs.o: hardisp/recurs.cpp hardisp/hardisp.hpp
	$(CXX) $(CXXFLAGS) -o $(@) hardisp/recurs.cpp
../obj/shells.o: hardisp/shells.cpp hardisp/hardisp.hpp
	$(CXX) $(CXXFLAGS) -o $(@) hardisp/shells.cpp
../obj/utils.o: hardisp/utils.cpp hardisp/hardisp.hpp
	$(CXX) $(CXXFLAGS) -o $(@) hardisp/utils.cpp
../obj/spline.o: hardisp/spline.cpp hardisp/hardisp.hpp
	$(CXX) $(CXXFLAGS) -o $(@) hardisp/spline.cpp
../obj/tdfrph.o: hardisp/tdfrph.cpp hardisp/hardisp.hpp hardisp/etutc.cpp hardisp/utils.cpp
	$(CXX) $(CXXFLAGS) -o $(@) hardisp/tdfrph.cpp
